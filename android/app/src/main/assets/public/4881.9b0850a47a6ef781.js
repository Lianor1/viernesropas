"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4881],{4881:(_,v,i)=>{i.r(v),i.d(v,{VaucherPageModule:()=>x});var a=i(1660),h=i(177),P=i(4341),l=i(4742),m=i(70),g=i(467),f=i(7239),C=i.n(f),M=i(9107),t=i(4438),y=i(8955),b=i(6868);const O=["vaucherContent"];function F(s,r){if(1&s&&(t.j41(0,"div",19)(1,"div",20)(2,"div",21),t.EFF(3),t.k0s(),t.j41(4,"div",22)(5,"span"),t.EFF(6),t.k0s(),t.j41(7,"span"),t.EFF(8),t.k0s()(),t.j41(9,"div",23)(10,"span"),t.EFF(11),t.k0s(),t.j41(12,"span"),t.EFF(13),t.k0s(),t.j41(14,"span"),t.EFF(15),t.k0s()()()()),2&s){const c=r.$implicit;t.R7$(3),t.JRh(c.nombre),t.R7$(3),t.SpI("Color: ",c.color,""),t.R7$(2),t.SpI("Talla: ",c.tallas,""),t.R7$(3),t.SpI("Cantidad: ",c.quantity,""),t.R7$(2),t.SpI("Precio Unitario: S/ ",c.precio,""),t.R7$(2),t.SpI("Precio Total: S/ ",c.precio*c.quantity,"")}}const V=[{path:"",component:(()=>{var s;class r{constructor(e,o,n,u,d){(0,a.A)(this,"router",void 0),(0,a.A)(this,"supabase",void 0),(0,a.A)(this,"loadingCtrl",void 0),(0,a.A)(this,"toastCtrl",void 0),(0,a.A)(this,"cartService",void 0),(0,a.A)(this,"vaucherContent",void 0),(0,a.A)(this,"cartItems",[]),(0,a.A)(this,"total",0),(0,a.A)(this,"vaucherNumber",void 0),(0,a.A)(this,"currentDate",new Date),(0,a.A)(this,"vaucherGuardado",!1),this.router=e,this.supabase=o,this.loadingCtrl=n,this.toastCtrl=u,this.cartService=d,this.vaucherNumber="V-"+Math.random().toString(36).substr(2,9).toUpperCase()}ngOnInit(){console.log("Iniciando VaucherPage");const e=this.cartService.getVaucherData();if(console.log("Datos del vaucher obtenidos:",e),!e||!e.cartItems||0===e.cartItems.length)return console.log("No hay datos de vaucher, redirigiendo..."),void this.router.navigate(["/carrito"]);this.cartItems=e.cartItems,this.total=e.total}guardarVaucherEnBD(){var e=this;return(0,g.A)(function*(){const o=yield e.loadingCtrl.create({message:"Guardando vaucher..."});try{yield o.present();const n=yield e.supabase.getCurrentUser();if(!n)throw new Error("No hay usuario autenticado");const u={numero_vaucher:e.vaucherNumber,fecha:e.currentDate.toISOString(),total:e.total,items:e.cartItems,usuario_id:n.id};yield e.supabase.guardarVaucher(u),e.vaucherGuardado=!0,(yield e.toastCtrl.create({message:"Vaucher guardado exitosamente",duration:2e3,color:"success"})).present()}catch(n){console.error("Error al guardar el vaucher:",n),(yield e.toastCtrl.create({message:"Error al guardar el vaucher",duration:2e3,color:"danger"})).present()}finally{o.dismiss()}})()}downloadAsPDF(){var e=this;return(0,g.A)(function*(){const o=yield e.loadingCtrl.create({message:"Generando PDF..."});yield o.present();try{e.vaucherGuardado||(yield e.guardarVaucherEnBD());const n=yield C()(e.vaucherContent.nativeElement),u=n.toDataURL("image/png"),d=new M.uE({orientation:"portrait",unit:"mm",format:"a4"}),p=d.internal.pageSize.getWidth();d.addImage(u,"PNG",0,0,p,n.height*p/n.width),d.save(`vaucher_${e.vaucherNumber}.pdf`),(yield e.toastCtrl.create({message:"PDF descargado exitosamente",duration:2e3,color:"success"})).present(),e.cartService.clearCart()}catch(n){console.error("Error al generar PDF:",n),(yield e.toastCtrl.create({message:"Error al generar el PDF",duration:2e3,color:"danger"})).present()}finally{o.dismiss()}})()}downloadImage(){var e=this;return(0,g.A)(function*(){const o=yield e.loadingCtrl.create({message:"Preparando imagen..."});yield o.present();try{e.vaucherGuardado||(yield e.guardarVaucherEnBD());const u=(yield C()(e.vaucherContent.nativeElement)).toDataURL("image/jpeg",1),d=document.createElement("a");d.href=u,d.download=`vaucher_${e.vaucherNumber}.jpg`,document.body.appendChild(d),d.click(),document.body.removeChild(d),(yield e.toastCtrl.create({message:"Imagen descargada exitosamente",duration:2e3,color:"success"})).present(),e.cartService.clearCart()}catch(n){console.error("Error al descargar la imagen:",n),(yield e.toastCtrl.create({message:"Error al descargar la imagen",duration:2e3,color:"danger"})).present()}finally{o.dismiss()}})()}goHome(){var e=this;return(0,g.A)(function*(){e.vaucherGuardado||(yield e.guardarVaucherEnBD()),e.cartService.clearCart(),e.router.navigate(["/home"])})()}}return s=r,(0,a.A)(r,"\u0275fac",function(e){return new(e||s)(t.rXU(m.Ix),t.rXU(y.w),t.rXU(l.Xi),t.rXU(l.K_),t.rXU(b.m))}),(0,a.A)(r,"\u0275cmp",t.VBU({type:s,selectors:[["app-vaucher"]],viewQuery:function(e,o){if(1&e&&t.GBs(O,7),2&e){let n;t.mGM(n=t.lsd())&&(o.vaucherContent=n.first)}},decls:36,vars:7,consts:[["vaucherContent",""],["slot","start"],["defaultHref","/home","text","","icon","arrow-back-outline"],[1,"ion-padding"],[1,"vaucher-container"],[1,"vaucher-header"],[1,"vaucher-number"],[1,"date"],[1,"products-section"],["class","product-item",4,"ngFor","ngForOf"],[1,"total-section"],[1,"total-amount"],[1,"action-buttons"],["fill","clear",1,"ion-text-center",3,"click"],[1,"button-inner"],["name","document-outline"],["fill","clear",3,"click"],["name","image-outline","slot","icon-only"],["name","home-outline","slot","start"],[1,"product-item"],[1,"product-details"],[1,"product-name"],[1,"product-info"],[1,"price-info"]],template:function(e,o){if(1&e){const n=t.RV6();t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),t.nrm(3,"ion-back-button",2),t.k0s(),t.j41(4,"ion-title"),t.EFF(5,"Vaucher de Compra"),t.k0s()()(),t.j41(6,"ion-content",3)(7,"div",4,0)(9,"div",5)(10,"h2"),t.EFF(11,"Vaucher de Compra"),t.k0s(),t.j41(12,"p",6),t.EFF(13),t.k0s(),t.j41(14,"p",7),t.EFF(15),t.nI1(16,"date"),t.k0s()(),t.j41(17,"div",8)(18,"h3"),t.EFF(19,"Detalle de Productos"),t.k0s(),t.DNE(20,F,16,6,"div",9),t.k0s(),t.j41(21,"div",10)(22,"h3"),t.EFF(23,"Total a Pagar"),t.k0s(),t.j41(24,"p",11),t.EFF(25),t.k0s()()(),t.j41(26,"div",12)(27,"ion-button",13),t.bIt("click",function(){return t.eBV(n),t.Njj(o.downloadAsPDF())}),t.j41(28,"div",14),t.nrm(29,"ion-icon",15),t.j41(30,"small"),t.EFF(31,"PDF"),t.k0s()()(),t.j41(32,"ion-button",16),t.bIt("click",function(){return t.eBV(n),t.Njj(o.downloadImage())}),t.nrm(33,"ion-icon",17),t.k0s(),t.j41(34,"ion-button",16),t.bIt("click",function(){return t.eBV(n),t.Njj(o.goHome())}),t.nrm(35,"ion-icon",18),t.k0s()()()}2&e&&(t.R7$(13),t.JRh(o.vaucherNumber),t.R7$(2),t.JRh(t.i5U(16,4,o.currentDate,"dd/MM/yyyy HH:mm")),t.R7$(5),t.Y8G("ngForOf",o.cartItems),t.R7$(5),t.SpI("S/ ",o.total,""))},dependencies:[h.Sq,l.Jm,l.QW,l.W9,l.eU,l.iq,l.BC,l.ai,l.el,h.vh],styles:[".vaucher-container[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:10px;box-shadow:0 2px 8px #0000001a}.vaucher-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px;padding-bottom:15px;border-bottom:2px solid #eee}.vaucher-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#333;margin-bottom:10px}.vaucher-header[_ngcontent-%COMP%]   .vaucher-number[_ngcontent-%COMP%]{font-size:18px;color:var(--ion-color-primary);font-weight:700;margin:5px 0}.vaucher-header[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{color:#666}.products-section[_ngcontent-%COMP%]{margin:20px 0}.products-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#333;margin-bottom:15px}.product-item[_ngcontent-%COMP%]{padding:15px;border-bottom:1px solid #eee}.product-item[_ngcontent-%COMP%]   .product-details[_ngcontent-%COMP%]   .product-name[_ngcontent-%COMP%]{font-size:16px;font-weight:700;color:#333;margin-bottom:8px}.product-item[_ngcontent-%COMP%]   .product-details[_ngcontent-%COMP%]   .product-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;color:#666;margin-bottom:8px}.product-item[_ngcontent-%COMP%]   .product-details[_ngcontent-%COMP%]   .product-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px}.product-item[_ngcontent-%COMP%]   .product-details[_ngcontent-%COMP%]   .price-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;color:#333}.product-item[_ngcontent-%COMP%]   .product-details[_ngcontent-%COMP%]   .price-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px}.product-item[_ngcontent-%COMP%]   .product-details[_ngcontent-%COMP%]   .price-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{font-weight:700}.total-section[_ngcontent-%COMP%]{background:#f5f5f5;padding:15px;border-radius:8px;margin:20px 0;text-align:center}.total-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#333;margin-bottom:10px}.total-section[_ngcontent-%COMP%]   .total-amount[_ngcontent-%COMP%]{font-size:24px;color:var(--ion-color-primary);font-weight:700;margin:0}.print-button[_ngcontent-%COMP%]{margin-top:20px;--background: var(--ion-color-primary)}.action-buttons[_ngcontent-%COMP%]{display:flex;justify-content:space-around;padding:1rem;margin-top:1rem}.action-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--padding-start: 1rem;--padding-end: 1rem}.action-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px}"]})),r})()}];let j=(()=>{var s;class r{}return s=r,(0,a.A)(r,"\u0275fac",function(e){return new(e||s)}),(0,a.A)(r,"\u0275mod",t.$C({type:s})),(0,a.A)(r,"\u0275inj",t.G2t({imports:[m.iI.forChild(V),m.iI]})),r})(),x=(()=>{var s;class r{}return s=r,(0,a.A)(r,"\u0275fac",function(e){return new(e||s)}),(0,a.A)(r,"\u0275mod",t.$C({type:s})),(0,a.A)(r,"\u0275inj",t.G2t({imports:[h.MD,P.YN,l.bv,j]})),r})()}}]);