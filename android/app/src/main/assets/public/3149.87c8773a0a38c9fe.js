"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3149],{3149:(H,y,f)=>{f.r(y),f.d(y,{HomePageModule:()=>T});var r=f(1660),b=f(177),i=f(4742),p=f(4341),C=f(70),d=f(467),n=f(4438),k=f(8955),v=f(3656),x=f(6868),E=f(487);const F=()=>[],j=()=>["/carrito"];function A(s,l){1&s&&(n.j41(0,"div",32),n.EFF(1,"\u2744"),n.k0s())}function I(s,l){if(1&s&&(n.j41(0,"ion-badge",33),n.EFF(1),n.k0s()),2&s){const c=n.XpG();n.R7$(),n.JRh(c.cartItemCount)}}function S(s,l){if(1&s){const c=n.RV6();n.j41(0,"ion-col",34)(1,"ion-card",35)(2,"ion-img",36),n.bIt("ionError",function(e){n.eBV(c);const o=n.XpG();return n.Njj(o.handleImageError(e))}),n.k0s(),n.j41(3,"ion-card-header")(4,"div",37)(5,"ion-card-title"),n.EFF(6),n.k0s(),n.j41(7,"ion-text",38)(8,"h3"),n.EFF(9),n.nI1(10,"number"),n.k0s()()()(),n.j41(11,"ion-card-content")(12,"p",39),n.EFF(13),n.k0s(),n.j41(14,"p",39),n.EFF(15),n.k0s(),n.j41(16,"p",39),n.EFF(17),n.k0s(),n.j41(18,"div",40)(19,"ion-button",41),n.bIt("click",function(){const e=n.eBV(c).$implicit,o=n.XpG();return n.Njj(o.addToCart(e))}),n.nrm(20,"ion-icon",42),n.k0s()()()()()}if(2&s){const c=l.$implicit;n.R7$(2),n.Y8G("src",c.imagen_url)("alt",c.nombre),n.R7$(4),n.JRh(c.nombre),n.R7$(3),n.SpI("S/ ",n.i5U(10,7,c.precio,"1.2-2"),""),n.R7$(4),n.SpI("Color: ",c.color,""),n.R7$(2),n.SpI("Talla: ",c.tallas,""),n.R7$(2),n.JRh(c.descripcion)}}const U=[{path:"",component:(()=>{var s;class l{constructor(t,e,o,a,g,u){(0,r.A)(this,"supabase",void 0),(0,r.A)(this,"menuCtrl",void 0),(0,r.A)(this,"router",void 0),(0,r.A)(this,"cartService",void 0),(0,r.A)(this,"platform",void 0),(0,r.A)(this,"themeService",void 0),(0,r.A)(this,"productos",[]),(0,r.A)(this,"productosFiltrados",[]),(0,r.A)(this,"categoriaActual","mujer"),(0,r.A)(this,"cartItemCount",0),(0,r.A)(this,"searchTerm",""),(0,r.A)(this,"isDarkMode",!1),(0,r.A)(this,"userProfile",null),(0,r.A)(this,"defaultAvatarUrl","assets/default-avatar.png"),(0,r.A)(this,"showSnow",!0),this.supabase=t,this.menuCtrl=e,this.router=o,this.cartService=a,this.platform=g,this.themeService=u,this.themeService.isDarkMode.subscribe(m=>this.isDarkMode=m)}ngOnInit(){this.cargarProductos(),this.cartService.getCartItemCount().subscribe(t=>{this.cartItemCount=t}),this.loadUserProfile()}ionViewWillEnter(){this.loadUserProfile()}cargarProductos(){var t=this;return(0,d.A)(function*(){try{const{data:e,error:o}=yield t.supabase.getProductos();if(o)return void console.error("Error al obtener productos:",o);console.log("Productos cargados:",e),t.productos=e,console.log("Categoria actual:",t.categoriaActual),t.filtrarProductos(t.categoriaActual),console.log("Productos filtrados:",t.productosFiltrados)}catch(e){console.error("Error al cargar productos:",e)}})()}filtrarProductos(t){this.categoriaActual=t.toLowerCase(),console.log("Filtrando por categor\xeda:",this.categoriaActual),this.productosFiltrados=this.productos.filter(e=>{const o=e.categoria.toLowerCase()===this.categoriaActual;return console.log(`Producto ${e.nombre}: categoria ${e.categoria} - coincide: ${o}`),o})}addToCart(t){this.cartService.addItem(t)}segmentChanged(t){const e=t.detail.value,a={MUJERES:"mujer",HOMBRES:"hombre",NI\u00d1OS:"nino",ACCESORIOS:"accesorio"}[e.toUpperCase()]||e;this.filtrarProductos(a)}buscarProductos(){const t=this.searchTerm.trim().toLowerCase();t?this.productosFiltrados=this.productos.filter(e=>{var o;return e.nombre.toLowerCase().includes(t)||(null===(o=e.id)||void 0===o?void 0:o.toString().includes(t))}):this.filtrarProductos(this.categoriaActual)}handleImageError(t){t.target.src="assets/images/default-product.png"}logout(){var t=this;return(0,d.A)(function*(){try{yield t.supabase.logout(),t.cartService.clearCart(),t.router.navigate(["/login"])}catch(e){console.error("Error al cerrar sesi\xf3n:",e)}})()}toggleTheme(){this.themeService.toggleDarkMode()}loadUserProfile(){var t=this;return(0,d.A)(function*(){try{const e=yield t.supabase.getCurrentUser();if(e){let{data:o,error:a}=yield t.supabase.getClient().from("profiles").select("*").eq("id",e.id).single();if(a){if("PGRST116"!==a.code)throw a;{const{data:g,error:u}=yield t.supabase.getClient().auth.getUser();if(u)throw u;const m=g.user.email||"",_=m.split("@")[0].split(".").map(O=>O.charAt(0).toUpperCase()+O.slice(1)).join(" "),P={id:e.id,email:m,nombre_completo:_,image:null,created_at:(new Date).toISOString()},{data:M,error:h}=yield t.supabase.getClient().from("profiles").insert(P).select().single();if(h)throw h;o=M}}if(o){if(o.image&&!o.image.startsWith("http")){console.log("Ruta de imagen original:",o.image);const{data:{publicUrl:g}}=t.supabase.getClient().storage.from("avatars").getPublicUrl(o.image);console.log("URL p\xfablica generada:",g),o.image=g}console.log("Perfil cargado:",o),t.userProfile=o}}}catch(e){console.error("Error loading user profile:",e)}})()}getImageUrl(t){if(!t)return console.log("No hay imagen, usando default:",this.defaultAvatarUrl),this.defaultAvatarUrl;if(t.startsWith("http"))return console.log("Usando URL directa:",t),t;console.log("Generando URL para:",t);const{data:{publicUrl:e}}=this.supabase.getClient().storage.from("avatars").getPublicUrl(t);return console.log("URL generada:",e),e}goToProfile(){this.router.navigate(["/home/profiles"])}}return s=l,(0,r.A)(l,"\u0275fac",function(t){return new(t||s)(n.rXU(k.w),n.rXU(i._t),n.rXU(C.Ix),n.rXU(x.m),n.rXU(v.OD),n.rXU(E.F))}),(0,r.A)(l,"\u0275cmp",n.VBU({type:s,selectors:[["app-home"]],decls:63,vars:12,consts:[["side","start","menuId","first","contentId","main-content"],[1,"snowfall-container"],["class","snowflake",4,"ngFor","ngForOf"],[1,"profile-section"],[1,"profile-avatar",3,"click"],["alt","Profile",3,"src"],[1,"profile-name"],[1,"profile-email"],["routerLink","/home"],["slot","start","name","home-outline"],["routerLink","/compras"],["slot","start","name","cart-outline"],["routerLink","/home/profiles"],["slot","start","name","settings-outline"],["color","danger",3,"click"],["slot","start","name","power-outline"],["slot","start"],["slot","end"],[3,"click"],[3,"name","color"],[1,"cart-btn",3,"routerLink"],["slot","icon-only","name","cart-outline"],["class","cart-badge",4,"ngIf"],["id","main-content"],["placeholder","Buscar producto por ID o nombre",3,"ngModelChange","ionChange","ngModel"],[1,"categories-container"],["value","mujer","scrollable","","mode","md",3,"ionChange"],["value","MUJERES","layout","text-only"],["value","HOMBRES","layout","text-only"],["value","NI\xd1OS","layout","text-only"],["value","ACCESORIOS","layout","text-only"],["size","6","size-md","6",4,"ngFor","ngForOf"],[1,"snowflake"],[1,"cart-badge"],["size","6","size-md","6"],[1,"producto-card"],[3,"ionError","src","alt"],[1,"header-content"],["color","primary"],[1,"producto-info"],[1,"cart-container"],["fill","clear",1,"cart-button",3,"click"],["name","cart-outline","color","primary"]],template:function(t,e){1&t&&(n.j41(0,"ion-menu",0)(1,"ion-header")(2,"ion-toolbar")(3,"ion-title"),n.EFF(4,"Men\xfa"),n.k0s()()(),n.j41(5,"ion-content")(6,"div",1),n.DNE(7,A,2,0,"div",2),n.k0s(),n.j41(8,"div",3)(9,"ion-avatar",4),n.bIt("click",function(){return e.goToProfile()}),n.nrm(10,"img",5),n.k0s(),n.j41(11,"h2",6),n.EFF(12),n.k0s(),n.j41(13,"p",7),n.EFF(14),n.k0s()(),n.j41(15,"ion-list")(16,"ion-item",8),n.nrm(17,"ion-icon",9),n.j41(18,"ion-label"),n.EFF(19,"Inicio"),n.k0s()(),n.j41(20,"ion-item",10),n.nrm(21,"ion-icon",11),n.j41(22,"ion-label"),n.EFF(23,"Mis Compras"),n.k0s()(),n.j41(24,"ion-item",12),n.nrm(25,"ion-icon",13),n.j41(26,"ion-label"),n.EFF(27,"Configuraci\xf3n"),n.k0s()(),n.j41(28,"ion-item",14),n.bIt("click",function(){return e.logout()}),n.nrm(29,"ion-icon",15),n.j41(30,"ion-label"),n.EFF(31,"Cerrar Sesi\xf3n"),n.k0s()()()()(),n.j41(32,"ion-header")(33,"ion-toolbar")(34,"ion-buttons",16),n.nrm(35,"ion-menu-button"),n.k0s(),n.j41(36,"ion-title"),n.EFF(37,"Productos"),n.k0s(),n.j41(38,"ion-buttons",17)(39,"ion-button",18),n.bIt("click",function(){return e.toggleTheme()}),n.nrm(40,"ion-icon",19),n.k0s(),n.j41(41,"ion-button",20),n.nrm(42,"ion-icon",21),n.DNE(43,I,2,1,"ion-badge",22),n.k0s()()()(),n.j41(44,"ion-content",23)(45,"ion-searchbar",24),n.mxI("ngModelChange",function(a){return n.DH7(e.searchTerm,a)||(e.searchTerm=a),a}),n.bIt("ionChange",function(){return e.buscarProductos()}),n.k0s(),n.j41(46,"div",25)(47,"ion-segment",26),n.bIt("ionChange",function(a){return e.segmentChanged(a)}),n.j41(48,"ion-segment-button",27)(49,"ion-label"),n.EFF(50,"MUJERES"),n.k0s()(),n.j41(51,"ion-segment-button",28)(52,"ion-label"),n.EFF(53,"HOMBRES"),n.k0s()(),n.j41(54,"ion-segment-button",29)(55,"ion-label"),n.EFF(56,"NI\xd1OS"),n.k0s()(),n.j41(57,"ion-segment-button",30)(58,"ion-label"),n.EFF(59,"ACCESORIOS"),n.k0s()()()(),n.j41(60,"ion-grid")(61,"ion-row"),n.DNE(62,S,21,10,"ion-col",31),n.k0s()()()),2&t&&(n.R7$(7),n.Y8G("ngForOf",n.lJ4(10,F).constructor(50)),n.R7$(3),n.Y8G("src",e.getImageUrl((null==e.userProfile?null:e.userProfile.image)||null),n.B4B),n.R7$(2),n.JRh((null==e.userProfile?null:e.userProfile.nombre_completo)||"Usuario"),n.R7$(2),n.JRh(null==e.userProfile?null:e.userProfile.email),n.R7$(26),n.Y8G("name",e.isDarkMode?"sunny-outline":"moon-outline")("color",e.isDarkMode?"warning":"primary"),n.R7$(),n.Y8G("routerLink",n.lJ4(11,j)),n.R7$(2),n.Y8G("ngIf",e.cartItemCount>0),n.R7$(2),n.R50("ngModel",e.searchTerm),n.R7$(17),n.Y8G("ngForOf",e.productosFiltrados))},dependencies:[b.Sq,b.bT,p.BC,p.vS,i.mC,i.In,i.Jm,i.QW,i.b_,i.I9,i.ME,i.tN,i.hU,i.W9,i.lO,i.eU,i.iq,i.KW,i.uz,i.he,i.nf,i.oS,i.MC,i.ln,i.S1,i.Gp,i.eP,i.IO,i.BC,i.ai,i.Je,i.Gw,i.N7,C.Wk,b.QX],styles:["#container[_ngcontent-%COMP%]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:20px;line-height:26px}#container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}ion-content[_ngcontent-%COMP%]{background:#fff}.producto-card[_ngcontent-%COMP%]{margin:8px;border-radius:12px;box-shadow:0 2px 6px #0000001a;background:#fff;overflow:hidden}.producto-card[_ngcontent-%COMP%]   ion-img[_ngcontent-%COMP%]{width:100%;height:250px;object-fit:cover;object-position:center}.producto-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{padding:12px}.producto-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.producto-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:16px;font-weight:500;margin:0}.producto-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:16px;font-weight:700;color:#1a73e8;margin:0}.producto-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:0 12px 12px}.producto-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;color:#1a73e8;margin:4px 0}.producto-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .producto-info[_ngcontent-%COMP%]{margin:4px 0;font-size:14px;color:#666}.producto-card[_ngcontent-%COMP%]   .tallas-container[_ngcontent-%COMP%]{display:flex;gap:4px;margin:8px 0}.producto-card[_ngcontent-%COMP%]   .tallas-container[_ngcontent-%COMP%]   .talla-circle[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;border:1px solid #1a73e8;display:flex;align-items:center;justify-content:center;font-size:12px;color:#1a73e8;background-color:#fff}ion-segment[_ngcontent-%COMP%]{--background: transparent}ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{--color: #666;--color-checked: #1a73e8;--indicator-color: #1a73e8}ion-searchbar[_ngcontent-%COMP%]{--box-shadow: none;--background: #fff;margin:10px;border-radius:8px}ion-grid[_ngcontent-%COMP%]{padding:10px}ion-col[_ngcontent-%COMP%]{padding:8px}.cart-btn[_ngcontent-%COMP%]{position:relative}.cart-btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:30px}.cart-btn[_ngcontent-%COMP%]   .cart-badge[_ngcontent-%COMP%]{--background: var(--ion-color-danger);border-radius:45%}.categorias-container[_ngcontent-%COMP%]{display:flex;overflow-x:auto;padding:10px;gap:10px}.categorias-container[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{flex-shrink:0}.categorias-container[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.profile-section[_ngcontent-%COMP%]{padding:20px;text-align:center;background:var(--ion-background-color)}.profile-section[_ngcontent-%COMP%]   .profile-avatar[_ngcontent-%COMP%]{width:80px;height:80px;margin:0 auto 10px;border:2px solid var(--ion-color-primary);cursor:pointer}.profile-section[_ngcontent-%COMP%]   .profile-name[_ngcontent-%COMP%]{margin:0;font-size:1.2em;font-weight:700;color:var(--ion-text-color)}.profile-section[_ngcontent-%COMP%]   .profile-email[_ngcontent-%COMP%]{margin:5px 0;font-size:.9em;color:var(--ion-text-color-secondary)}.snowfall-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;overflow:hidden;pointer-events:none;z-index:1}.snowflake[_ngcontent-%COMP%]{position:absolute;color:#005dfd;font-size:1em;opacity:0}.snowflake[_ngcontent-%COMP%]:nth-child(1){left:2%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:1s}.snowflake[_ngcontent-%COMP%]:nth-child(2){left:4%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:2s}.snowflake[_ngcontent-%COMP%]:nth-child(3){left:6%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:3s}.snowflake[_ngcontent-%COMP%]:nth-child(4){left:8%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:4s}.snowflake[_ngcontent-%COMP%]:nth-child(5){left:10%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:5s}.snowflake[_ngcontent-%COMP%]:nth-child(6){left:12%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:6s}.snowflake[_ngcontent-%COMP%]:nth-child(7){left:14%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:7s}.snowflake[_ngcontent-%COMP%]:nth-child(8){left:16%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:8s}.snowflake[_ngcontent-%COMP%]:nth-child(9){left:18%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:9s}.snowflake[_ngcontent-%COMP%]:nth-child(10){left:20%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:0s}.snowflake[_ngcontent-%COMP%]:nth-child(11){left:22%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:1s}.snowflake[_ngcontent-%COMP%]:nth-child(12){left:24%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:2s}.snowflake[_ngcontent-%COMP%]:nth-child(13){left:26%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:3s}.snowflake[_ngcontent-%COMP%]:nth-child(14){left:28%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:4s}.snowflake[_ngcontent-%COMP%]:nth-child(15){left:30%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:5s}.snowflake[_ngcontent-%COMP%]:nth-child(16){left:32%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:6s}.snowflake[_ngcontent-%COMP%]:nth-child(17){left:34%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:7s}.snowflake[_ngcontent-%COMP%]:nth-child(18){left:36%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:8s}.snowflake[_ngcontent-%COMP%]:nth-child(19){left:38%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:9s}.snowflake[_ngcontent-%COMP%]:nth-child(20){left:40%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:0s}.snowflake[_ngcontent-%COMP%]:nth-child(21){left:42%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:1s}.snowflake[_ngcontent-%COMP%]:nth-child(22){left:44%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:2s}.snowflake[_ngcontent-%COMP%]:nth-child(23){left:46%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:3s}.snowflake[_ngcontent-%COMP%]:nth-child(24){left:48%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:4s}.snowflake[_ngcontent-%COMP%]:nth-child(25){left:50%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:5s}.snowflake[_ngcontent-%COMP%]:nth-child(26){left:52%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:6s}.snowflake[_ngcontent-%COMP%]:nth-child(27){left:54%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:7s}.snowflake[_ngcontent-%COMP%]:nth-child(28){left:56%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:8s}.snowflake[_ngcontent-%COMP%]:nth-child(29){left:58%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:9s}.snowflake[_ngcontent-%COMP%]:nth-child(30){left:60%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:0s}.snowflake[_ngcontent-%COMP%]:nth-child(31){left:62%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:1s}.snowflake[_ngcontent-%COMP%]:nth-child(32){left:64%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:2s}.snowflake[_ngcontent-%COMP%]:nth-child(33){left:66%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:3s}.snowflake[_ngcontent-%COMP%]:nth-child(34){left:68%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:4s}.snowflake[_ngcontent-%COMP%]:nth-child(35){left:70%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:5s}.snowflake[_ngcontent-%COMP%]:nth-child(36){left:72%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:6s}.snowflake[_ngcontent-%COMP%]:nth-child(37){left:74%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:7s}.snowflake[_ngcontent-%COMP%]:nth-child(38){left:76%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:8s}.snowflake[_ngcontent-%COMP%]:nth-child(39){left:78%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:9s}.snowflake[_ngcontent-%COMP%]:nth-child(40){left:80%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:0s}.snowflake[_ngcontent-%COMP%]:nth-child(41){left:82%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:1s}.snowflake[_ngcontent-%COMP%]:nth-child(42){left:84%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:2s}.snowflake[_ngcontent-%COMP%]:nth-child(43){left:86%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:3s}.snowflake[_ngcontent-%COMP%]:nth-child(44){left:88%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:4s}.snowflake[_ngcontent-%COMP%]:nth-child(45){left:90%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:5s}.snowflake[_ngcontent-%COMP%]:nth-child(46){left:92%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:6s}.snowflake[_ngcontent-%COMP%]:nth-child(47){left:94%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:7s}.snowflake[_ngcontent-%COMP%]:nth-child(48){left:96%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:8s}.snowflake[_ngcontent-%COMP%]:nth-child(49){left:98%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:9s}.snowflake[_ngcontent-%COMP%]:nth-child(50){left:100%;animation:_ngcontent-%COMP%_snowfall 10s linear infinite;animation-delay:0s}@keyframes _ngcontent-%COMP%_snowfall{0%{opacity:0;transform:translateY(-20vh)}20%{opacity:.8}90%{opacity:.8}to{opacity:0;transform:translateY(100vh)}}@keyframes _ngcontent-%COMP%_drift{0%{transform:translateY(-90px)}}ion-header[_ngcontent-%COMP%], ion-content[_ngcontent-%COMP%]{position:relative;z-index:2}.profile-section[_ngcontent-%COMP%]{position:relative;z-index:2;background:#ffffff1a;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);padding:20px;text-align:center}.profile-section[_ngcontent-%COMP%]   .profile-avatar[_ngcontent-%COMP%]{width:80px;height:80px;margin:0 auto 10px;border:2px solid var(--ion-color-primary)}.profile-section[_ngcontent-%COMP%]   .profile-name[_ngcontent-%COMP%]{margin:10px 0 5px;font-weight:700}.profile-section[_ngcontent-%COMP%]   .profile-email[_ngcontent-%COMP%]{margin:5px 0;font-size:.9em;opacity:.8}ion-menu[_ngcontent-%COMP%]{--background: #ffffff}ion-menu[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: #ffffff}ion-menu[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]{background:transparent}ion-menu[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: transparent;--color: var(--ion-text-color)}ion-menu[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-primary)}"]})),l})()},{path:"profiles",component:(()=>{var s;class l{constructor(t,e,o,a,g){(0,r.A)(this,"supabase",void 0),(0,r.A)(this,"loadingCtrl",void 0),(0,r.A)(this,"toastCtrl",void 0),(0,r.A)(this,"actionSheetCtrl",void 0),(0,r.A)(this,"router",void 0),(0,r.A)(this,"profile",{id:"",nombre_completo:"",email:"",created_at:(new Date).toISOString(),image:null}),this.supabase=t,this.loadingCtrl=e,this.toastCtrl=o,this.actionSheetCtrl=a,this.router=g}ngOnInit(){var t=this;return(0,d.A)(function*(){yield t.loadProfile()})()}loadProfile(){var t=this;return(0,d.A)(function*(){const e=yield t.loadingCtrl.create();yield e.present();try{const o=yield t.supabase.getCurrentUser();if(!o)throw new Error("No user found");const{data:a,error:g}=yield t.supabase.getClient().from("profiles").select("*").eq("id",o.id).single();if(g)throw g;a&&(t.profile=a)}catch(o){console.error("Error loading profile:",o),t.showToast("Error al cargar el perfil")}finally{e.dismiss()}})()}selectImage(){var t=this;return(0,d.A)(function*(){try{const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=function(){var o=(0,d.A)(function*(a){const g=a.target.files[0];if(g){const u=yield t.loadingCtrl.create({message:"Subiendo imagen..."});yield u.present();try{const m=yield t.supabase.getCurrentUser();if(!m)throw new Error("No user found");const w=g.name.split(".").pop(),_=`${Date.now()}.${w}`,P=`${m.id}/${_}`,{error:h}=yield t.supabase.getClient().storage.from("avatars").upload(P,g,{cacheControl:"3600",upsert:!1});if(h)throw h;const{data:{publicUrl:O}}=t.supabase.getClient().storage.from("avatars").getPublicUrl(P);yield t.updateProfileImage(O),t.profile.image=O,t.showToast("Imagen actualizada con \xe9xito")}catch(m){console.error("Error:",m),t.showToast("Error al subir la imagen")}finally{u.dismiss()}}});return function(a){return o.apply(this,arguments)}}(),e.click()}catch(e){console.error("Error:",e),t.showToast("Error al seleccionar la imagen")}})()}updateProfile(){var t=this;return(0,d.A)(function*(){const e=yield t.loadingCtrl.create();yield e.present();try{const o=yield t.supabase.getCurrentUser();if(!o)throw new Error("No user found");if(t.profile.image&&t.profile.image.startsWith("data:image")){const u=yield(yield fetch(t.profile.image)).blob(),w=`${Date.now()}.jpg`,_=`${o.id}/${w}`,{error:M}=yield t.supabase.getClient().storage.from("avatars").upload(_,u,{contentType:"image/jpeg",upsert:!0});if(M)throw M;const{data:{publicUrl:h}}=t.supabase.getClient().storage.from("avatars").getPublicUrl(_);t.profile.image=h}const{error:a}=yield t.supabase.getClient().from("profiles").update({nombre_completo:t.profile.nombre_completo,image:t.profile.image}).eq("id",o.id);if(a)throw a;t.showToast("Perfil actualizado con \xe9xito"),t.router.navigate(["/home"])}catch(o){console.error("Error updating profile:",o),t.showToast("Error al actualizar el perfil")}finally{e.dismiss()}})()}showToast(t){var e=this;return(0,d.A)(function*(){yield(yield e.toastCtrl.create({message:t,duration:2e3})).present()})()}updateProfileImage(t){var e=this;return(0,d.A)(function*(){try{const o=yield e.supabase.getCurrentUser();if(!o)throw new Error("No user found");const{error:a}=yield e.supabase.getClient().from("profiles").update({image:t}).eq("id",o.id);if(a)throw a}catch(o){throw console.error("Error updating profile image:",o),o}})()}presentActionSheet(){var t=this;return(0,d.A)(function*(){yield(yield t.actionSheetCtrl.create({header:"Seleccionar imagen",buttons:[{text:"Seleccionar de la galer\xeda",icon:"image",handler:()=>{t.selectImage()}},{text:"Cancelar",icon:"close",role:"cancel"}]})).present()})()}getImageUrl(t){if(!t)return"assets/default-avatar.jpg";if(t.startsWith("data:image")||t.startsWith("http"))return t;const{data:{publicUrl:e}}=this.supabase.getClient().storage.from("avatars").getPublicUrl(t);return e}}return s=l,(0,r.A)(l,"\u0275fac",function(t){return new(t||s)(n.rXU(k.w),n.rXU(i.Xi),n.rXU(i.K_),n.rXU(i.GD),n.rXU(C.Ix))}),(0,r.A)(l,"\u0275cmp",n.VBU({type:s,selectors:[["app-profiles"]],decls:23,vars:3,consts:[["slot","start"],["defaultHref","/home","text",""],[1,"ion-padding"],[1,"profile-image-container"],[3,"click"],["alt","Profile",3,"src"],[1,"change-photo-overlay"],["name","camera"],[3,"ngSubmit"],["position","stacked"],["name","nombre_completo",3,"ngModelChange","ngModel"],["name","email","readonly","",3,"ngModelChange","ngModel"],["expand","block","type","submit",1,"ion-margin-top"]],template:function(t,e){1&t&&(n.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),n.nrm(3,"ion-back-button",1),n.k0s(),n.j41(4,"ion-title"),n.EFF(5,"Mi Perfil"),n.k0s()()(),n.j41(6,"ion-content",2)(7,"div",3)(8,"ion-avatar",4),n.bIt("click",function(){return e.presentActionSheet()}),n.nrm(9,"img",5),n.j41(10,"div",6),n.nrm(11,"ion-icon",7),n.k0s()()(),n.j41(12,"form",8),n.bIt("ngSubmit",function(){return e.updateProfile()}),n.j41(13,"ion-item")(14,"ion-label",9),n.EFF(15,"Nombre completo"),n.k0s(),n.j41(16,"ion-input",10),n.mxI("ngModelChange",function(a){return n.DH7(e.profile.nombre_completo,a)||(e.profile.nombre_completo=a),a}),n.k0s()(),n.j41(17,"ion-item")(18,"ion-label",9),n.EFF(19,"Email"),n.k0s(),n.j41(20,"ion-input",11),n.mxI("ngModelChange",function(a){return n.DH7(e.profile.email,a)||(e.profile.email=a),a}),n.k0s()(),n.j41(21,"ion-button",12),n.EFF(22," Guardar cambios "),n.k0s()()()),2&t&&(n.R7$(9),n.Y8G("src",e.getImageUrl(e.profile.image),n.B4B),n.R7$(7),n.R50("ngModel",e.profile.nombre_completo),n.R7$(4),n.R50("ngModel",e.profile.email))},dependencies:[p.qT,p.BC,p.cb,p.vS,p.cV,i.mC,i.Jm,i.QW,i.W9,i.eU,i.iq,i.$w,i.uz,i.he,i.BC,i.ai,i.Gw,i.el],styles:[".profile-image-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin:20px 0}.profile-image-container[_ngcontent-%COMP%]   ion-avatar[_ngcontent-%COMP%]{width:120px;height:120px;margin-bottom:10px;border:3px solid var(--ion-color-primary);position:relative;cursor:pointer}.profile-image-container[_ngcontent-%COMP%]   ion-avatar[_ngcontent-%COMP%]   .change-photo-overlay[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;right:0;background:#0009;height:40%;display:flex;justify-content:center;align-items:center}.profile-image-container[_ngcontent-%COMP%]   ion-avatar[_ngcontent-%COMP%]   .change-photo-overlay[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#fff;font-size:24px}"]})),l})()}];let R=(()=>{var s;class l{}return s=l,(0,r.A)(l,"\u0275fac",function(t){return new(t||s)}),(0,r.A)(l,"\u0275mod",n.$C({type:s})),(0,r.A)(l,"\u0275inj",n.G2t({imports:[C.iI.forChild(U),C.iI]})),l})(),T=(()=>{var s;class l{}return s=l,(0,r.A)(l,"\u0275fac",function(t){return new(t||s)}),(0,r.A)(l,"\u0275mod",n.$C({type:s})),(0,r.A)(l,"\u0275inj",n.G2t({imports:[b.MD,p.YN,i.bv,R]})),l})()}}]);